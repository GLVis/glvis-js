<!DOCTYPE html>
<meta charset="UTF-8" />
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/async/3.2.0/async.min.js"></script>
    <script src="../src/glvis.js"></script>
    <script src="../src/index.js"></script>
    <script src="./keys.js"></script>
    <script src="./example_stream.js"></script>
    <link rel="icon" type="image/png" href="https://glvis.org/img/favicon.ico">
  </head>

  <body>
    <div align="center" style="padding-top: 10pm">
      <div
        style="
          white-space: pre;
          display: inline-block;
          height: 480px;
          width: 40ch;
          border: 4px solid #ccc;
          overflow: auto;
          font-family: monospace;
        "
        id="keys-div"
      ></div>
      <div
        style="display: inline-block; border: 4px solid #ccc"
        id="glvis-div"
        tabindex="0"
      ></div>
    </div>

    <script type="text/javascript">
      const ws = new WebSocket('ws://localhost:8080');
      ws.addEventListener('open', function (event) { console.log('socket opened'); });
      ws.addEventListener('close', function (event) { console.log('socket closed'); });

      document.getElementById("keys-div").innerHTML = keys_str;
      var div = document.getElementById("glvis-div");
      var canvas = glvis.setupCanvas(div, 640, 480);
      glvis.displayStream(div, canvas, example_stream);


      var que = async.queue(async function(task, callback) {
        glvis.displayStream(div, canvas, task);
        await new Promise(r => setTimeout(r, 1000));
      });

      ws.addEventListener('message', function (event) {
        console.log("got msg");
        que.push(event.data);
      });
    </script>

    <div align="center">
      <input
        type="file"
        id="load_stream"
        onchange="glvis.loadStream(event, div, canvas)"
      />
      <input
        type="button"
        onchange="connect()"
      >
    </div>
  </body>
</html>
