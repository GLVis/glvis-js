<!DOCTYPE html>
<meta charset="UTF-8" />
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/async/3.2.0/async.min.js"></script>
    <script src="../src/glvis.js"></script>
    <script src="../src/index.js"></script>
    <script src="./keys.js"></script>
    <script src="./example_stream.js"></script>
    <link
      rel="icon"
      type="image/png"
      href="https://glvis.org/img/favicon.ico"
    />
  </head>

  <body>
    <div align="center" style="padding-top: 10pm">
      <div
        style="
          white-space: pre;
          display: inline-block;
          height: 480px;
          width: 40ch;
          border: 4px solid #ccc;
          overflow: auto;
          font-family: monospace;
        "
        id="keys-div"
      ></div>
      <div
        style="display: inline-block; border: 4px solid #ccc"
        id="glvis-div"
        tabindex="0"
      ></div>
    </div>

    <script type="text/javascript">
      var ws = undefined;
      var que = async.queue(async function (msg) {
        glv.displayStream(msg);
        await new Promise((r) => setTimeout(r, 500));
      });

      function connect() {
        if (ws !== undefined && ws.readyState == 1) {
          ws.close();
          return;
        }

        const host = document.getElementById("host-text").value;
        const port = document.getElementById("port-text").value;
        var btn = document.getElementById("conn-btn");

        const addr = `ws:\/\/${host}:${port}`;
        console.log(`trying to connect to ${addr}`);
        ws = new WebSocket(addr);

        ws.addEventListener("open", function (event) {
          var url = event.target.url;
          console.log(`connected to ${url}`);
          btn.innerHTML = "Disconnect";
        });
        ws.addEventListener("close", function (event) {
          console.log("disconnected");
          btn.innerHTML = "Connect";
        });
        ws.addEventListener("message", function (event) {
          console.log(`got message from ${event.origin}`);
          que.push(event.data);
        });
      }

      document.getElementById("keys-div").innerHTML = keys_str;
      var div = document.getElementById("glvis-div");
      var glv = new glvis.State(div);
      glv.displayStream(example_stream);
    </script>

    <div align="center">
      <input
        type="file"
        id="load_stream"
        onchange="glvis.loadStream(event, glv)"
      />
    </div>
    <div align="center">
      <input type="text" id="host-text" value="localhost" />
      <input type="text" id="port-text" value="8080" />
      <button type="button" id="conn-btn" onclick="connect()">Connect</button>
    </div>

    <p>
    <div align="center">
      <button type="button" onclick="glv.sendKey('p')">&#x21DA</button>
      switch color palette
      <button type="button" onclick="glv.sendKey('P')">&#x21DB</button>
    </div>

    <p>
    <div align="center">
      <button type="button" onclick="glv.sendKey('r')">Reset 3D View</button>
    </div>

    <p>
    <div align="center">
      Light:
      <input type="radio" id="off" name="light" oninput="glv.sendKey('l')"><label for="off">Off</label>
      <input type="radio" id="on" name="light" checked="checked" oninput="glv.sendKey('l')"><label for="on">On</label>
    </div>

    <p>
    <div align="center">
      Colorbar:
      <input type="radio" id="off" name="colorbar" checked="checked" oninput="glv.sendKey('c')"><label for="off">Off</label>
      <input type="radio" id="on" name="colorbar" oninput="glv.sendKey('c')"><label for="on">On</label>
    </div>

    <p>
    <div align="center">
      Perspective:
      <input type="radio" id="off" name="perspective" oninput="glv.sendKey('j')"><label for="off">Off</label>
      <input type="radio" id="on" name="perspective" checked="checked" oninput="glv.sendKey('j')"><label for="on">On</label>
    </div>

    <p>
    <div align="center">
      Axis:
      <input type="radio" id="off" name="axis" checked="checked" oninput="glv.sendKey('a')"><label for="off">Off</label>
      <input type="radio" id="on" name="axis" oninput="glv.sendKey('a')"><label for="on">On</label>
      <input type="radio" id="min" name="axis" oninput="glv.sendKey('a')"><label for="min">Minimal</label>
      <input type="radio" id="gr" name="axis" oninput="glv.sendKey('a')"><label for="gr">Gray</label>
    </div>

    <p>
    <div align="center">
      Mesh:
      <input type="radio" id="off" name="mesh" checked="checked" oninput="glv.sendKey('m')"><label for="off">Off</label>
      <input type="radio" id="on" name="mesh" oninput="glv.sendKey('m')"><label for="on">On</label>
      <input type="radio" id="ll" name="mesh" oninput="glv.sendKey('m')"><label for="ll">Level Lines</label>
    </div>
  </body>
</html>
